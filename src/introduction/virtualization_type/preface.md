X86操作系统是直接运行在裸硬件设备的操作系统软件，在操作系统看来，它们完全占有这些硬件设备资源。x86 架构为CPU提供四个特权级别给操作系统和应用程序来访问硬件。

CPU特权级别分为Ring0, Ring1, Ring2, Ring3。Ring0具有最高级别，其余级别依次递减。

以X86操作系统为例，操作系统需要直接访问硬件和内存，因此它的内核代码需要运行在最高运行级别Ring0上，这样它可以使用特权指令，控制中断、修改页表、访问设备等等。

应用程序的代码则运行在最低运行级别上Ring3上，因此对底层硬件没有控制访问权限。但是如果应用程序需要访问磁盘，写文件，它需要通过执行系统调用命令，在执行系统调用时，CPU的运行级别会发生从Ring3切换到Ring0，并跳转到系统调用对应的内核代码位置执行，这样内核就为你完成了设备访问，完成之后再从Ring0返回Ring3。这个过程也称作用户态和内核态的切换。

**什么是虚拟化？**

RedHat对虚拟化有如下定义：

* “虚拟化”是一个描述运行软件的广义计算机术语，通常体现为在单一系统上运行多个操作系统，这些操作系统同时运行，而每个操作系统又是相互独立的。大多数现行的虚拟化实现使用一个”虚拟机管理程序”（hypervisor），即一个软件层或子系统，该子系统控制硬件并向“客户机操作系统“提供访问底层硬件的途径。通过向客户机操作系统提供虚拟化的硬件虚拟机管理程序允许多种操作系统在相同的物理系统中运行，该虚拟机管理系统称为“客户机”。

结合篇章开头所述，X86操作系统运行在Ring0上，这里将其认为是HostOS。若要在该Host操作系统上运行多个操作系统，则这些虚拟的客户机操作系统GuestOS就不可以运行在Ring0，不然HostOS将无处安放，必然会被毁掉。然而不能运行在Ring0级别的GuestOS没有访问底层硬件的权限（实际上GuestOS运行在用户态Ring3级别），因此出现了“虚拟机管理程序”，即Hypervisor，Hypervisor 是一种运行在物理服务器和操作系统之间的中间软件层（可以是软件程序，也可以是固件程序，可以运行在用户态，也可以运行在内核态），可为多个操作系统和应用共享一套基础物理硬件，协调访问服务器上的所有物理设备和虚拟机，也叫虚拟机监视器VMM（Virtual Machine Monitor）。

Hypervisor是所有虚拟化技术的核心。非中断地支持多工作负载迁移的能力是Hypervisor的基本功能。当服务器启动并执行Hypervisor时，它会给每一台虚拟机分配适量的内存、CPU、网络和磁盘，并加载所有虚拟机的客户操作系统。

Hypervisor有多种类型，不同的人对它的类型有不同的分类方式。这里我们分为全虚拟化和半虚拟化。在下个篇章详细介绍。

